# Overthrust - ILVR-FWI Benchmark Configuration
# Diffusion-based FWI with ILVR (Iterative Latent Variable Refinement) conditioning
# Overthrust velocity model: 70x190 (requires patch-based processing)
# Usage: python diffusion_bench/run_bench.py --method ilvr --config configs/overthrust/diffusion_bench_ilvr.yaml

pde:
  n_grid: 190  # Horizontal grid size (width) - matches Overthrust width
  nt: 1000
  dx: 10.0
  dt: 0.001
  nbc: 120
  f: 15.0
  sz: 10
  gz: 10
  ng: 190  # Number of receivers - matches number of seismic traces
  ns: 5

model:
  dim: 64
  dim_mults: [1, 2, 4, 8]
  flash_attn: false
  channels: 1

diffusion:
  image_size: 72  # Diffusion model trained on 70x70 patches (72x72 with padding)
  timesteps: 1000
  sampling_timesteps: 250
  objective: pred_noise
  model_path: pretrained_models/model-3.pt  # Model trained on Overthrust

optimization:
  # Basic FWI parameters
  lr: 0.03
  ts: 10  # Number of FWI iterations per diffusion step (BEST: dt100_ts10)
  diffusion_ts: 100  # Number of diffusion timesteps (BEST: dt100_ts10)

  # Initial model settings
  sigma: 20.0
  initial_type: smoothed

  # Data augmentation
  noise_std: 0.0
  noise_type: gaussian
  missing_number: 0

  # Gradient processing tricks (BEST: smooth_blur)
  grad_norm: false  # Normalize gradients by initial maximum
  grad_smooth: 1.0  # Gaussian smoothing sigma (BEST: smooth_blur)
  model_blur: true  # Apply Gaussian blur to model after each update (BEST: smooth_blur)
  grad_clip: 1.0  # Gradient clipping factor

  # ILVR-specific parameters
  use_ilvr: true  # Enable ILVR conditioning
  ilvr_weight: 0.05  # ILVR weighting factor (0.01-0.5, higher = stronger conditioning)
  ilvr_down_schedule: linear  # Downsampling schedule: 'linear' (16â†’2) or 'stepwise' ([32,16,8,4])

  # Patch-based processing for large/non-square images
  use_patches: true  # Required for 70x190 Overthrust
  patch_kernel_size: [70, 70]  # Patch size (height, width)
  patch_stride: [1, 60]  # Stride (height, width) - overlapping patches for smooth reconstruction

data:
  seismic_data_dir: dataset/Overthrust/Seismic_Data/
  velocity_data_dir: dataset/Overthrust/Velocity_Data/
  batch_size: 1  # Process one sample at a time for diffusion_bench
  data_pattern: "*.npy"
  use_mmap: true

experiment:
  name: overthrust_ilvr_fwi
  results_dir: diffusion_bench_results/
  save_intermediate: false
  log_interval: 10
  save_metrics: true
  random_seed: 8888
